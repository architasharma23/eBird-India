<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Spatial sampling (no filters) | Source code and supplementary material for independent validation of State of India’s birds</title>
  <meta name="description" content="Section 2 Spatial sampling (no filters) | Source code and supplementary material for independent validation of State of India’s birds" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Spatial sampling (no filters) | Source code and supplementary material for independent validation of State of India’s birds" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="vjjan91/SoIB-independent-validation" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Spatial sampling (no filters) | Source code and supplementary material for independent validation of State of India’s birds" />
  
  
  

<meta name="author" content="Vijay Ramesh" />


<meta name="date" content="2022-10-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="temporal-sampling-no-filters.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.1</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html"><i class="fa fa-check"></i><b>2</b> Spatial sampling (no filters)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#prepare-libraries"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="2.2" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#subset-observations-by-geographical-confines-of-the-study-area"><i class="fa fa-check"></i><b>2.2</b> Subset observations by geographical confines of the study area</a></li>
<li class="chapter" data-level="2.3" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#data-cleaning-prior-to-visualization"><i class="fa fa-check"></i><b>2.3</b> Data cleaning prior to visualization</a></li>
<li class="chapter" data-level="2.4" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#load-spatial-grids-for-checklist-locations"><i class="fa fa-check"></i><b>2.4</b> Load spatial grids for checklist locations</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#get-proportional-observation-counts-across-every-25-km-x-25-km-grid"><i class="fa fa-check"></i><b>2.5</b> Get proportional observation counts across every 25 km x 25 km grid</a></li>
<li class="chapter" data-level="2.6" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#filter-data-only-for-a-specific-list-of-species"><i class="fa fa-check"></i><b>2.6</b> Filter data only for a specific list of species</a></li>
<li class="chapter" data-level="2.7" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#checklist-distribution"><i class="fa fa-check"></i><b>2.7</b> Checklist distribution</a></li>
<li class="chapter" data-level="2.8" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#figure-checklist-distribution"><i class="fa fa-check"></i><b>2.8</b> Figure: Checklist distribution</a></li>
<li class="chapter" data-level="2.9" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#what-species-are-reported-sufficiently-in-checklists"><i class="fa fa-check"></i><b>2.9</b> What species are reported sufficiently in checklists?</a></li>
<li class="chapter" data-level="2.10" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#figure-proportion-of-checklists-reporting-species-in-each-grid-cell"><i class="fa fa-check"></i><b>2.10</b> Figure: Proportion of checklists reporting species in each grid cell</a></li>
<li class="chapter" data-level="2.11" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#write-the-species-lists-to-file"><i class="fa fa-check"></i><b>2.11</b> write the species lists to file</a></li>
<li class="chapter" data-level="2.12" data-path="spatial-sampling-no-filters.html"><a href="spatial-sampling-no-filters.html#save-.rdata-for-future-scripts"><i class="fa fa-check"></i><b>2.12</b> save .RData for future scripts</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html"><i class="fa fa-check"></i><b>3</b> Temporal sampling (no filters)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html#prepare-libraries-1"><i class="fa fa-check"></i><b>3.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="3.2" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html#filter-data-using-auk-package"><i class="fa fa-check"></i><b>3.2</b> Filter data using auk package</a></li>
<li class="chapter" data-level="3.3" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html#process-filtered-data"><i class="fa fa-check"></i><b>3.3</b> Process filtered data</a></li>
<li class="chapter" data-level="3.4" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html#include-only-species-with-scientific-names"><i class="fa fa-check"></i><b>3.4</b> Include only species with scientific names</a></li>
<li class="chapter" data-level="3.5" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html#subset-data-by-time-period"><i class="fa fa-check"></i><b>3.5</b> Subset data by time period</a></li>
<li class="chapter" data-level="3.6" data-path="temporal-sampling-no-filters.html"><a href="temporal-sampling-no-filters.html#subset-data-spatially"><i class="fa fa-check"></i><b>3.6</b> Subset data spatially</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code and supplementary material for independent validation of State of India’s birds</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-sampling-no-filters" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Section 2</span> Spatial sampling (no filters)<a href="spatial-sampling-no-filters.html#spatial-sampling-no-filters" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this script, we will examine data at the species level for a chosen list of species, across its entire geographic range in the Indian subcontinent. Our aim here is to first understand the proportion of checklists that report the species of interests for every 25 x 25 km grid size (finer scale will be chosen for comparison in a future script).</p>
<p>No other filters are applied in this particular script.</p>
<div id="prepare-libraries" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Prepare libraries<a href="spatial-sampling-no-filters.html#prepare-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="spatial-sampling-no-filters.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb1-2"><a href="spatial-sampling-no-filters.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="spatial-sampling-no-filters.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-4"><a href="spatial-sampling-no-filters.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-5"><a href="spatial-sampling-no-filters.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="spatial-sampling-no-filters.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="spatial-sampling-no-filters.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-8"><a href="spatial-sampling-no-filters.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-9"><a href="spatial-sampling-no-filters.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="spatial-sampling-no-filters.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-11"><a href="spatial-sampling-no-filters.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scico)</span>
<span id="cb1-12"><a href="spatial-sampling-no-filters.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb1-13"><a href="spatial-sampling-no-filters.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-14"><a href="spatial-sampling-no-filters.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-15"><a href="spatial-sampling-no-filters.html#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="spatial-sampling-no-filters.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># round any function</span></span>
<span id="cb1-17"><a href="spatial-sampling-no-filters.html#cb1-17" aria-hidden="true" tabindex="-1"></a>round_25 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">accuracy =</span> <span class="dv">25000</span>) {</span>
<span id="cb1-18"><a href="spatial-sampling-no-filters.html#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(x <span class="sc">/</span> accuracy) <span class="sc">*</span> accuracy</span>
<span id="cb1-19"><a href="spatial-sampling-no-filters.html#cb1-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-20"><a href="spatial-sampling-no-filters.html#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="spatial-sampling-no-filters.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># set file paths for auk functions</span></span>
<span id="cb1-22"><a href="spatial-sampling-no-filters.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># To use these two datasets, please download the latest versions from https://ebird.org/data/download and set the file path accordingly. Since these two datasets are extremely large, we have not uploaded the same to GitHub.</span></span>
<span id="cb1-23"><a href="spatial-sampling-no-filters.html#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># In this study, the version of data loaded corresponds to July 2022.</span></span>
<span id="cb1-24"><a href="spatial-sampling-no-filters.html#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="spatial-sampling-no-filters.html#cb1-25" aria-hidden="true" tabindex="-1"></a>f_in_ebd <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;data/ebd_IN_relJul-2022.txt&quot;</span>)</span>
<span id="cb1-26"><a href="spatial-sampling-no-filters.html#cb1-26" aria-hidden="true" tabindex="-1"></a>f_in_sampling <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;data/ebd_sampling_relJul-2022.txt&quot;</span>)</span></code></pre></div>
</div>
<div id="subset-observations-by-geographical-confines-of-the-study-area" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Subset observations by geographical confines of the study area<a href="spatial-sampling-no-filters.html#subset-observations-by-geographical-confines-of-the-study-area" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this case, the geographical confines correspond to the political boundary of India.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="spatial-sampling-no-filters.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we load the India states boundary from GADM</span></span>
<span id="cb2-2"><a href="spatial-sampling-no-filters.html#cb2-2" aria-hidden="true" tabindex="-1"></a>india_states <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/spatial/shapefiles/india_states_boundary.shp&quot;</span>)</span>
<span id="cb2-3"><a href="spatial-sampling-no-filters.html#cb2-3" aria-hidden="true" tabindex="-1"></a>box_in <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(india_states)</span>
<span id="cb2-4"><a href="spatial-sampling-no-filters.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="spatial-sampling-no-filters.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># read in ebd data and subset by state for our analysis</span></span>
<span id="cb2-6"><a href="spatial-sampling-no-filters.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># To access the latest dataset, please visit: https://ebird.org/data/download and set the file path accordingly.</span></span>
<span id="cb2-7"><a href="spatial-sampling-no-filters.html#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="spatial-sampling-no-filters.html#cb2-8" aria-hidden="true" tabindex="-1"></a>ebd <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;data/ebd_IN_relJul-2022.txt&quot;</span>)</span>
<span id="cb2-9"><a href="spatial-sampling-no-filters.html#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="spatial-sampling-no-filters.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># subsettting by lat-long</span></span>
<span id="cb2-11"><a href="spatial-sampling-no-filters.html#cb2-11" aria-hidden="true" tabindex="-1"></a>ebd_in <span class="ot">&lt;-</span> ebd[<span class="fu">between</span>(LONGITUDE, box_in[<span class="st">&quot;xmin&quot;</span>], box_in[<span class="st">&quot;xmax&quot;</span>]) <span class="sc">&amp;</span></span>
<span id="cb2-12"><a href="spatial-sampling-no-filters.html#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(LATITUDE, box_in[<span class="st">&quot;ymin&quot;</span>], box_in[<span class="st">&quot;ymax&quot;</span>]), ] <span class="co"># resulted in removal of 21 observations in total</span></span>
<span id="cb2-13"><a href="spatial-sampling-no-filters.html#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="spatial-sampling-no-filters.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># make new column names</span></span>
<span id="cb2-15"><a href="spatial-sampling-no-filters.html#cb2-15" aria-hidden="true" tabindex="-1"></a>newNames <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(<span class="fu">colnames</span>(ebd_in), <span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="spatial-sampling-no-filters.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_lower</span>()</span>
<span id="cb2-17"><a href="spatial-sampling-no-filters.html#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(ebd_in, newNames)</span>
<span id="cb2-18"><a href="spatial-sampling-no-filters.html#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># keep useful columns</span></span>
<span id="cb2-19"><a href="spatial-sampling-no-filters.html#cb2-19" aria-hidden="true" tabindex="-1"></a>columnsOfInterest <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-20"><a href="spatial-sampling-no-filters.html#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;common_name&quot;</span>, <span class="st">&quot;scientific_name&quot;</span>, <span class="st">&quot;observation_count&quot;</span>, <span class="st">&quot;locality&quot;</span>, <span class="st">&quot;state&quot;</span>, <span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;locality_type&quot;</span>, <span class="st">&quot;latitude&quot;</span>,</span>
<span id="cb2-21"><a href="spatial-sampling-no-filters.html#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;observation_date&quot;</span>, <span class="st">&quot;time_observations_started&quot;</span>, <span class="st">&quot;protocol_type&quot;</span>,<span class="st">&quot;duration_minutes&quot;</span>,<span class="st">&quot;effort_distance_km&quot;</span>, <span class="st">&quot;number_observers&quot;</span>, <span class="st">&quot;group_identifier&quot;</span>, <span class="st">&quot;reviewed&quot;</span>, <span class="st">&quot;sampling_event_identifier&quot;</span></span>
<span id="cb2-22"><a href="spatial-sampling-no-filters.html#cb2-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-23"><a href="spatial-sampling-no-filters.html#cb2-23" aria-hidden="true" tabindex="-1"></a>ebd_in <span class="ot">&lt;-</span> ebd_in[, ..columnsOfInterest]</span>
<span id="cb2-24"><a href="spatial-sampling-no-filters.html#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="spatial-sampling-no-filters.html#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the large ebd file if it&#39;s not required</span></span>
<span id="cb2-26"><a href="spatial-sampling-no-filters.html#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(ebd)</span>
<span id="cb2-27"><a href="spatial-sampling-no-filters.html#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>() <span class="co"># run this function to clear up some memory space</span></span></code></pre></div>
</div>
<div id="data-cleaning-prior-to-visualization" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Data cleaning prior to visualization<a href="spatial-sampling-no-filters.html#data-cleaning-prior-to-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="spatial-sampling-no-filters.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert all presences marked &#39;X&#39; as &#39;1&#39;</span></span>
<span id="cb3-2"><a href="spatial-sampling-no-filters.html#cb3-2" aria-hidden="true" tabindex="-1"></a>ebd_in <span class="ot">&lt;-</span> ebd_in <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="spatial-sampling-no-filters.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">observation_count =</span> <span class="fu">ifelse</span>(observation_count <span class="sc">==</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb3-4"><a href="spatial-sampling-no-filters.html#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;1&quot;</span>, observation_count</span>
<span id="cb3-5"><a href="spatial-sampling-no-filters.html#cb3-5" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb3-6"><a href="spatial-sampling-no-filters.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="spatial-sampling-no-filters.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert observation count to numeric</span></span>
<span id="cb3-8"><a href="spatial-sampling-no-filters.html#cb3-8" aria-hidden="true" tabindex="-1"></a>ebd_in<span class="sc">$</span>observation_count <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ebd_in<span class="sc">$</span>observation_count)</span></code></pre></div>
</div>
<div id="load-spatial-grids-for-checklist-locations" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Load spatial grids for checklist locations<a href="spatial-sampling-no-filters.html#load-spatial-grids-for-checklist-locations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Add a spatial filter.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="spatial-sampling-no-filters.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># strict spatial filter and assign grid</span></span>
<span id="cb4-2"><a href="spatial-sampling-no-filters.html#cb4-2" aria-hidden="true" tabindex="-1"></a>locs <span class="ot">&lt;-</span> ebd_in[, .(longitude, latitude)]</span>
<span id="cb4-3"><a href="spatial-sampling-no-filters.html#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="spatial-sampling-no-filters.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to UTM </span></span>
<span id="cb4-5"><a href="spatial-sampling-no-filters.html#cb4-5" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">setDF</span>(locs) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="spatial-sampling-no-filters.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="spatial-sampling-no-filters.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">st_crs&lt;-</span><span class="st">`</span>(<span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="spatial-sampling-no-filters.html#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">as.data.table</span>(<span class="fu">st_coordinates</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="spatial-sampling-no-filters.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">&quot;+proj=laea +lon_0=80.859375 +lat_0=20.6486698 +datum=WGS84 +units=m +no_defs&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="spatial-sampling-no-filters.html#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb4-11"><a href="spatial-sampling-no-filters.html#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="spatial-sampling-no-filters.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># make some empty space</span></span>
<span id="cb4-13"><a href="spatial-sampling-no-filters.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb4-14"><a href="spatial-sampling-no-filters.html#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="spatial-sampling-no-filters.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to UTM for filter</span></span>
<span id="cb4-16"><a href="spatial-sampling-no-filters.html#cb4-16" aria-hidden="true" tabindex="-1"></a>india_states <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(india_states, <span class="st">&quot;+proj=laea +lon_0=80.859375 +lat_0=20.6486698 +datum=WGS84 +units=m +no_defs&quot;</span>)</span>
<span id="cb4-17"><a href="spatial-sampling-no-filters.html#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="spatial-sampling-no-filters.html#cb4-18" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> coords <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="spatial-sampling-no-filters.html#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">unlist</span>(<span class="fu">st_contains</span>(india_states, coords))) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="spatial-sampling-no-filters.html#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">longitude =</span> X, <span class="at">latitude =</span> Y) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="spatial-sampling-no-filters.html#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">as.data.table</span>(<span class="fu">st_coordinates</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="spatial-sampling-no-filters.html#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="spatial-sampling-no-filters.html#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>()</span>
<span id="cb4-24"><a href="spatial-sampling-no-filters.html#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="spatial-sampling-no-filters.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># remove unneeded objects</span></span>
<span id="cb4-26"><a href="spatial-sampling-no-filters.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(locs)</span>
<span id="cb4-27"><a href="spatial-sampling-no-filters.html#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb4-28"><a href="spatial-sampling-no-filters.html#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="spatial-sampling-no-filters.html#cb4-29" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> coords[, .N, by <span class="ot">=</span> .(longitude, latitude, X, Y)]</span>
<span id="cb4-30"><a href="spatial-sampling-no-filters.html#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="spatial-sampling-no-filters.html#cb4-31" aria-hidden="true" tabindex="-1"></a>ebd_in <span class="ot">&lt;-</span> <span class="fu">merge</span>(ebd_in, coords, <span class="at">all =</span> <span class="cn">FALSE</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>))</span>
<span id="cb4-32"><a href="spatial-sampling-no-filters.html#cb4-32" aria-hidden="true" tabindex="-1"></a>ebd_in <span class="ot">&lt;-</span> ebd_in[(longitude <span class="sc">%in%</span> coords<span class="sc">$</span>longitude) <span class="sc">&amp;</span></span>
<span id="cb4-33"><a href="spatial-sampling-no-filters.html#cb4-33" aria-hidden="true" tabindex="-1"></a>  (latitude <span class="sc">%in%</span> coords<span class="sc">$</span>latitude), ]</span></code></pre></div>
</div>
<div id="get-proportional-observation-counts-across-every-25-km-x-25-km-grid" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Get proportional observation counts across every 25 km x 25 km grid<a href="spatial-sampling-no-filters.html#get-proportional-observation-counts-across-every-25-km-x-25-km-grid" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Analysis of proportional counts estimated at 25km</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="spatial-sampling-no-filters.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Analysis of proportional counts at 25 km for each state</span></span>
<span id="cb5-2"><a href="spatial-sampling-no-filters.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="spatial-sampling-no-filters.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># round to 25km cell in UTM coords</span></span>
<span id="cb5-4"><a href="spatial-sampling-no-filters.html#cb5-4" aria-hidden="true" tabindex="-1"></a>ebd_in[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">X =</span> <span class="fu">round_25</span>(X), <span class="at">Y =</span> <span class="fu">round_25</span>(Y))]</span>
<span id="cb5-5"><a href="spatial-sampling-no-filters.html#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="spatial-sampling-no-filters.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># count checklists in cell</span></span>
<span id="cb5-7"><a href="spatial-sampling-no-filters.html#cb5-7" aria-hidden="true" tabindex="-1"></a>ebd_summary <span class="ot">&lt;-</span> ebd_in[, nchk <span class="sc">:</span><span class="er">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(sampling_event_identifier)),</span>
<span id="cb5-8"><a href="spatial-sampling-no-filters.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(X, Y)]</span>
<span id="cb5-9"><a href="spatial-sampling-no-filters.html#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="spatial-sampling-no-filters.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># count checklists reporting each species in cell and get proportion</span></span>
<span id="cb5-11"><a href="spatial-sampling-no-filters.html#cb5-11" aria-hidden="true" tabindex="-1"></a>ebd_summary <span class="ot">&lt;-</span> ebd_summary[, .(<span class="at">nrep =</span> <span class="fu">length</span>(<span class="fu">unique</span>(</span>
<span id="cb5-12"><a href="spatial-sampling-no-filters.html#cb5-12" aria-hidden="true" tabindex="-1"></a>  sampling_event_identifier</span>
<span id="cb5-13"><a href="spatial-sampling-no-filters.html#cb5-13" aria-hidden="true" tabindex="-1"></a>))),</span>
<span id="cb5-14"><a href="spatial-sampling-no-filters.html#cb5-14" aria-hidden="true" tabindex="-1"></a>by <span class="ot">=</span> .(X, Y, nchk, scientific_name)</span>
<span id="cb5-15"><a href="spatial-sampling-no-filters.html#cb5-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-16"><a href="spatial-sampling-no-filters.html#cb5-16" aria-hidden="true" tabindex="-1"></a>ebd_summary[, p_rep <span class="sc">:</span><span class="er">=</span> nrep <span class="sc">/</span> nchk]</span>
<span id="cb5-17"><a href="spatial-sampling-no-filters.html#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="spatial-sampling-no-filters.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># complete the dataframe for no reports</span></span>
<span id="cb5-19"><a href="spatial-sampling-no-filters.html#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># keep no reports as NA --- allows filtering based on proportion reporting</span></span>
<span id="cb5-20"><a href="spatial-sampling-no-filters.html#cb5-20" aria-hidden="true" tabindex="-1"></a>ebd_summary <span class="ot">&lt;-</span> <span class="fu">setDF</span>(ebd_summary) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="spatial-sampling-no-filters.html#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb5-22"><a href="spatial-sampling-no-filters.html#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nesting</span>(X, Y), scientific_name <span class="co"># ,</span></span>
<span id="cb5-23"><a href="spatial-sampling-no-filters.html#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill = list(p_rep = 0)</span></span>
<span id="cb5-24"><a href="spatial-sampling-no-filters.html#cb5-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="spatial-sampling-no-filters.html#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_rep))</span></code></pre></div>
</div>
<div id="filter-data-only-for-a-specific-list-of-species" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Filter data only for a specific list of species<a href="spatial-sampling-no-filters.html#filter-data-only-for-a-specific-list-of-species" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We filtered data for a subset of 891 species.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="spatial-sampling-no-filters.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove species that are poorly reported (only filter being applied at this stage)</span></span>
<span id="cb6-2"><a href="spatial-sampling-no-filters.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for example, accounts such as &#39;Turdidae sp.&#39;, are removed and only the latest</span></span>
<span id="cb6-3"><a href="spatial-sampling-no-filters.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list of scientific names are taken into consideration</span></span>
<span id="cb6-4"><a href="spatial-sampling-no-filters.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="spatial-sampling-no-filters.html#cb6-5" aria-hidden="true" tabindex="-1"></a>species_list <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/2022-SoIB-species-list.csv&quot;</span>)</span>
<span id="cb6-6"><a href="spatial-sampling-no-filters.html#cb6-6" aria-hidden="true" tabindex="-1"></a>speciesOfInterest <span class="ot">&lt;-</span> species_list <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="spatial-sampling-no-filters.html#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Selected...SOIB <span class="sc">==</span><span class="st">&quot;X&quot;</span>)</span>
<span id="cb6-8"><a href="spatial-sampling-no-filters.html#cb6-8" aria-hidden="true" tabindex="-1"></a>speciesOfInterest <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(speciesOfInterest<span class="sc">$</span>Scientific.Name)</span>
<span id="cb6-9"><a href="spatial-sampling-no-filters.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(speciesOfInterest) <span class="ot">&lt;-</span> <span class="st">&quot;scientific_name&quot;</span></span>
<span id="cb6-10"><a href="spatial-sampling-no-filters.html#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="spatial-sampling-no-filters.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># filter for species list above - we are choosing only the 891 species</span></span>
<span id="cb6-12"><a href="spatial-sampling-no-filters.html#cb6-12" aria-hidden="true" tabindex="-1"></a>ebd_summary <span class="ot">&lt;-</span> ebd_summary[ebd_summary<span class="sc">$</span>scientific_name <span class="sc">%in%</span> speciesOfInterest<span class="sc">$</span>scientific_name, ]</span></code></pre></div>
</div>
<div id="checklist-distribution" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Checklist distribution<a href="spatial-sampling-no-filters.html#checklist-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="spatial-sampling-no-filters.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total number of checklists across unique grids</span></span>
<span id="cb7-2"><a href="spatial-sampling-no-filters.html#cb7-2" aria-hidden="true" tabindex="-1"></a>tot_n_chklist <span class="ot">&lt;-</span> ebd_summary <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="spatial-sampling-no-filters.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(X, Y, nchk)</span>
<span id="cb7-4"><a href="spatial-sampling-no-filters.html#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="spatial-sampling-no-filters.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># India has a total of 4792 unique 25 x 25 km grids</span></span>
<span id="cb7-6"><a href="spatial-sampling-no-filters.html#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="spatial-sampling-no-filters.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># species-specific number of grids</span></span>
<span id="cb7-8"><a href="spatial-sampling-no-filters.html#cb7-8" aria-hidden="true" tabindex="-1"></a>spp_grids <span class="ot">&lt;-</span> ebd_summary <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="spatial-sampling-no-filters.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scientific_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="spatial-sampling-no-filters.html#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(X, Y) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="spatial-sampling-no-filters.html#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(scientific_name,</span>
<span id="cb7-12"><a href="spatial-sampling-no-filters.html#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;n_grids&quot;</span></span>
<span id="cb7-13"><a href="spatial-sampling-no-filters.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-14"><a href="spatial-sampling-no-filters.html#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="spatial-sampling-no-filters.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the above two results</span></span>
<span id="cb7-16"><a href="spatial-sampling-no-filters.html#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(spp_grids, <span class="st">&quot;results/01_ngrids-per-spp.csv&quot;</span>, <span class="at">row.names=</span>F)</span>
<span id="cb7-17"><a href="spatial-sampling-no-filters.html#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="spatial-sampling-no-filters.html#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># left-join the datasets</span></span>
<span id="cb7-19"><a href="spatial-sampling-no-filters.html#cb7-19" aria-hidden="true" tabindex="-1"></a>ebd_summary <span class="ot">&lt;-</span> <span class="fu">left_join</span>(ebd_summary, spp_grids, <span class="at">by =</span> <span class="st">&quot;scientific_name&quot;</span>)</span></code></pre></div>
</div>
<div id="figure-checklist-distribution" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Figure: Checklist distribution<a href="spatial-sampling-no-filters.html#figure-checklist-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="spatial-sampling-no-filters.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add land</span></span>
<span id="cb8-2"><a href="spatial-sampling-no-filters.html#cb8-2" aria-hidden="true" tabindex="-1"></a>land <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(</span>
<span id="cb8-3"><a href="spatial-sampling-no-filters.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">50</span>, <span class="at">type =</span> <span class="st">&quot;countries&quot;</span>, <span class="at">continent =</span> <span class="st">&quot;asia&quot;</span>,</span>
<span id="cb8-4"><a href="spatial-sampling-no-filters.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="st">&quot;india&quot;</span>,</span>
<span id="cb8-5"><a href="spatial-sampling-no-filters.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">returnclass =</span> <span class="fu">c</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb8-6"><a href="spatial-sampling-no-filters.html#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="spatial-sampling-no-filters.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># crop land</span></span>
<span id="cb8-8"><a href="spatial-sampling-no-filters.html#cb8-8" aria-hidden="true" tabindex="-1"></a>land <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(land, <span class="st">&quot;+proj=laea +lon_0=80.859375 +lat_0=20.6486698 +datum=WGS84 +units=m +no_defs&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figs/fig_number_checklists_25km.png" alt="" />
<p class="caption">Number of checklists over time</p>
</div>
</div>
<div id="what-species-are-reported-sufficiently-in-checklists" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> What species are reported sufficiently in checklists?<a href="spatial-sampling-no-filters.html#what-species-are-reported-sufficiently-in-checklists" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Similar to Ramesh et al. (2022), we visualized and listed species that occurred in atleast 5% of all checklists across half of the unique study area grids they were reported from.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="spatial-sampling-no-filters.html#cb9-1" aria-hidden="true" tabindex="-1"></a>p_cutoff <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="co"># Proportion of checklists a species has been reported in</span></span>
<span id="cb9-2"><a href="spatial-sampling-no-filters.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="spatial-sampling-no-filters.html#cb9-3" aria-hidden="true" tabindex="-1"></a>grid_proportions <span class="ot">&lt;-</span> ebd_summary <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="spatial-sampling-no-filters.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scientific_name) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="spatial-sampling-no-filters.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>(p_rep <span class="sc">&gt;=</span> p_cutoff) <span class="sc">%&gt;%</span> <span class="co"># n here is the number of grids in which a species has been reported in over 5% of checklists</span></span>
<span id="cb9-6"><a href="spatial-sampling-no-filters.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_grids_cut =</span> n <span class="sc">/</span> (spp_grids<span class="sc">$</span>n_grids)) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="spatial-sampling-no-filters.html#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(prop_grids_cut))</span>
<span id="cb9-8"><a href="spatial-sampling-no-filters.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="spatial-sampling-no-filters.html#cb9-9" aria-hidden="true" tabindex="-1"></a>grid_prop_cut <span class="ot">&lt;-</span> <span class="fu">filter</span>(</span>
<span id="cb9-10"><a href="spatial-sampling-no-filters.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  grid_proportions,</span>
<span id="cb9-11"><a href="spatial-sampling-no-filters.html#cb9-11" aria-hidden="true" tabindex="-1"></a>  prop_grids_cut <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="co"># How many species have been reported in atleast 5% of checklists across atleast 50% of the grids they have been reported from? </span></span>
<span id="cb9-12"><a href="spatial-sampling-no-filters.html#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-13"><a href="spatial-sampling-no-filters.html#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="spatial-sampling-no-filters.html#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Only 254 species!</span></span>
<span id="cb9-15"><a href="spatial-sampling-no-filters.html#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="spatial-sampling-no-filters.html#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the results</span></span>
<span id="cb9-17"><a href="spatial-sampling-no-filters.html#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(grid_prop_cut, <span class="st">&quot;results/01_prop-grids-per-spp.csv&quot;</span>, <span class="at">row.names =</span> F)</span>
<span id="cb9-18"><a href="spatial-sampling-no-filters.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="spatial-sampling-no-filters.html#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifying the number of species that occur in potentially &lt;5% of all lists</span></span>
<span id="cb9-20"><a href="spatial-sampling-no-filters.html#cb9-20" aria-hidden="true" tabindex="-1"></a>total_number_lists <span class="ot">&lt;-</span> <span class="fu">sum</span>(tot_n_chklist<span class="sc">$</span>nchk)</span>
<span id="cb9-21"><a href="spatial-sampling-no-filters.html#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="spatial-sampling-no-filters.html#cb9-22" aria-hidden="true" tabindex="-1"></a>spp_sum_chk <span class="ot">&lt;-</span> ebd_summary <span class="sc">%&gt;%</span></span>
<span id="cb9-23"><a href="spatial-sampling-no-filters.html#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(X, Y, scientific_name, nrep) <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="spatial-sampling-no-filters.html#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(scientific_name) <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a href="spatial-sampling-no-filters.html#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum_chk =</span> <span class="fu">sum</span>(nrep)) <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a href="spatial-sampling-no-filters.html#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(scientific_name, sum_chk)</span>
<span id="cb9-27"><a href="spatial-sampling-no-filters.html#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="spatial-sampling-no-filters.html#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 88 species of the list of 877 occur in &gt;5% of all checklists</span></span>
<span id="cb9-29"><a href="spatial-sampling-no-filters.html#cb9-29" aria-hidden="true" tabindex="-1"></a>prop_all_lists <span class="ot">&lt;-</span> spp_sum_chk <span class="sc">%&gt;%</span></span>
<span id="cb9-30"><a href="spatial-sampling-no-filters.html#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_lists =</span> sum_chk <span class="sc">/</span> total_number_lists) <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="spatial-sampling-no-filters.html#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(prop_lists))</span></code></pre></div>
</div>
<div id="figure-proportion-of-checklists-reporting-species-in-each-grid-cell" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> Figure: Proportion of checklists reporting species in each grid cell<a href="spatial-sampling-no-filters.html#figure-proportion-of-checklists-reporting-species-in-each-grid-cell" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Note: Here we plot all species that occur in atleast 5% of all checklists across half of the 25 x 25 km cells from where they have been reported</p>
</div>
<div id="write-the-species-lists-to-file" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> write the species lists to file<a href="spatial-sampling-no-filters.html#write-the-species-lists-to-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="spatial-sampling-no-filters.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the list of species that occur in at least 5% of checklists across a minimum of 50% of the grids they have been reported in</span></span>
<span id="cb10-2"><a href="spatial-sampling-no-filters.html#cb10-2" aria-hidden="true" tabindex="-1"></a>sp_list <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(speciesOfInterest, grid_prop_cut, <span class="at">by =</span> <span class="st">&quot;scientific_name&quot;</span>)</span>
<span id="cb10-3"><a href="spatial-sampling-no-filters.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(sp_list, <span class="st">&quot;results/01_list-of-species-cutoff50.csv&quot;</span>, <span class="at">row.names =</span> F)</span></code></pre></div>
</div>
<div id="save-.rdata-for-future-scripts" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> save .RData for future scripts<a href="spatial-sampling-no-filters.html#save-.rdata-for-future-scripts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="spatial-sampling-no-filters.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save.image</span>(<span class="at">file =</span> <span class="st">&quot;data/01_ebd-India.RData&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="temporal-sampling-no-filters.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vjjan91/SoIB-independent-validation/edit/master/01_spatial-sampling-no-filters.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
